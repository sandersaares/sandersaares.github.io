[{"authors":["sandersaares"],"categories":null,"content":"First and foremost a product creator, having been the architect and technical lead for several innovative products.\nExpert in modern video streaming technologies, with focus on:\n Content security and DRM on both the client and server side Design and implementation of content processing workflows Using open source and commercial toolchains Creating new tools to fill gaps in available functionality  Familiar with modern DevOps practices in cloud and on premise, including:\n Azure Pipelines GitHub Workflows Docker containers Prometheus \u0026amp; Grafana  Maintainer of the prometheus-net open source library for instrumenting .NET apps with metrics.\nContributor to DASH-IF, an industry association that defines interoperability guidelines and specifications for modern media streaming technologies.\nSolid understanding of computer networks, including multicast deployments and custom network protocol design.\nExtensive experience with C# development on all versions of the .NET platform, including .NET Core; working familiarity with C+ +, Python, PowerShell, Go, WPF, ASP.NET Core, Entity Framework, NuGet, gRPC, OData, Packer, Vagrant and other technologies\n","date":1588896000,"expirydate":-62135596800,"kind":"taxonomy","lang":"en","lastmod":1588896000,"objectID":"14d4679960a75106241f33efd5e31b03","permalink":"/authors/sandersaares/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/sandersaares/","section":"authors","summary":"First and foremost a product creator, having been the architect and technical lead for several innovative products.\nExpert in modern video streaming technologies, with focus on:\n Content security and DRM on both the client and server side Design and implementation of content processing workflows Using open source and commercial toolchains Creating new tools to fill gaps in available functionality  Familiar with modern DevOps practices in cloud and on premise, including:","tags":null,"title":"Sander Saares","type":"authors"},{"authors":["Sander Saares"],"categories":["media streaming","content security","DRM is not a black box"],"content":"The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies. A content processing workflow designed for adaptive streaming is a content processing workflow ready for DRM.\nThe two media delivery technologies of relevance here are DASH1 and HLS2. The Apple ecosystem uses HLS, whereas everything else uses DASH. In order to understand encryption, you need to understand how content is structured when using these technologies.\n\rOther lesser known delivery technologies are occasionally used by some vendors. However, these alternative technologies are insignificant in the big picture and their use only leads to vendor lock-in and excessive cost. Use DASH and HLS.\r\r\rStructure of DASH and HLS Most solutions wish to target viewers on both Apple and non-Apple platforms and therefore need to present all content using both the DASH and HLS delivery technologies. Thankfully this is not as burdensome as it sounds because the two are in fact different flavors of the same thing.\nThe link between the two technologies is CMAF3 (a cousin of the well-known MP4 file format) which defines a common format for media data storage compatible with both DASH and HLS. The latter two technologies define the format of the manifest files that contain instructions for players on how to access the content stored in the shared CMAF media files.\n\rRelationships between DASH, HLS and CMAF\r\r\rDASH manifest files are served to DASH players, which will use the information within to load data from CMAF media files. HLS manifest files are served to HLS players, which will use the information within to load data from CMAF media files. As the bulk of the data is in the shared CMAF files, there is no duplication of storage costs or excessive CDN throughput despite using two different media delivery technologies.\n\rThe contents of the HLS and DASH manifest files are quite similar and it is often easy to convert from one to the other. This means that a content processing workflow only capable of working with either DASH or HLS can be easily enhanced by post-processing to produce the other manifest format.\r\r\rThe audio and video data exists in the form of samples, where one sample is one video frame (e.g. 24 samples per second) or a similar duration of audio data. Samples are grouped into self-contained segments of 2-10 second duration, where each segment is independently presentable by players without having to reference data in any other segment. A CMAF header contains the technical parameters required for a decoder to process the data contained in the segments.\n\r\rStructure of CMAF media data storage\r\r\rSegments may either be stored in separate files or in one giant CMAF track file (effectively just a concatenated series of segments prefixed with the CMAF header). The storage format largely depends on workflow-specific configuration and content processing service compatibility - different services expect the data to exist in different forms.\nApplying DRM to movies The media samples stored inside the CMAF files are encrypted. DRM technologies rely on encryption to control when and where the media data can be used for playback, creating situations where the decryption key is only provided to authorized DRM clients and only when all the necessary conditions to ensure adequate content protection are met.\nEncryption is performed individually for each sample - it is not the files themselves that are encrypted but only the actual audio/video data within them. Even there, encryption is only partially applied - for video data only 10% of each sample is encrypted, leaving 90% in the clear. As the encryption is applied in a repeating pattern of 1:9 blocks, it is sometimes called pattern encryption. One block is 16 bytes.\n\r10% pattern encryption applied to data in video samples\r\r\r\rThe rationale for using pattern encryption is that encrypting 10% of the data is sufficient to make the samples unusable without the key while minimizing the impact of decryption on processor capacity and battery life. Audio samples are fully encrypted due to their relatively small size.\r\r\rA small prefix of up to 32 bytes in each sample is typically left in the clear to enable sample headers to be processed. This technique of dividing a sample into clear and encrypted regions is called subsample encryption. For encryption algorithm purposes (e.g. where does the 10% pattern start) the clear prefix is considered not to be a part of the sample.\n\rSubsample encryption leaves an optional clear prefix to expose the sample headers\r\r\rSubsample encryption is typically only used with video tracks and does not need to be configured by the operator - content processing tools that encrypt data already know when a clear prefix is required and will insert it automatically.\nThe technical details of encryption are described by the cbcs protection scheme defined in the Common Encryption4 standard. You may see material online referencing the cenc protection scheme but this scheme is effectively becoming obsolete as Apple devices do not support it. Modern devices use cbcs. In addition to cryptographic differences, the cenc protection scheme does not use pattern encryption but encrypts the entire sample.\n\rIf your target device set contains devices that do not support the cbcs protection scheme then you will need to create two copies of every encrypted track - one encrypted with cbcs (for Apple and newer non-Apple devices) and one with cenc (for older non-Apple devices).\r\r\rAfter applying encryption the movie is safe for publishing over unprotected channels. You do not need to guard access to the files as the content cannot be accessed without the key. In some high-security scenarios, you might still care about protecting access to the files as part of a defense-in-depth strategy (e.g. by using URL signing to control who can download the files) but on a cryptographic level the sample data is now unusable for an attacker.\n\rAll modern DRM technologies use the same encryption algorithms that are equally strong - there is no difference in the strength of encryption between DRM technologies. However, different DRM client implementations do have different strengths and weaknesses. This will be explored in depth by the next article in this series.\r\r\rTo apply encryption, you need to know the key and the key ID (or KID). The key is a 128-bit symmetric key (i.e. the same key is used for encryption and decryption). The KID is a separate (non-secret) 128-bit value used elsewhere in DRM workflows to reference a specific key. Key management is a large topic of its own, to be covered in a separate article.\nDifferent data formats are used for representing keys and KIDs, depending on the situation and the specific piece of software. In practice, the KID is typically formatted as a GUID5 (a0a8db17-20c7-4068-bfbd-f8a68e34f1a5) and the key as a base64 or hexadecimal string (FSu0UIH8Z06IOyXVlnmc8Q== or 0x152bb45081fc674e883b25d596799cf1).\n\rGUIDs have multiple different binary representations! The \u0026ldquo;Linux style\u0026rdquo; binary format is acheived by removing the dashes and treating a GUID as a hexadecimal string. The \u0026ldquo;Windows style\u0026rdquo; binary format is achieved in a more complex fashion, with a different order of bytes.\nMedia streaming systems typically use the Linux style binary format. This has caused much pain when software platforms assume Windows style and developers only discover that 2 years into production when integrating another system that uses Linux style. In hindsight using GUIDs for KIDs was a mistake but it\u0026rsquo;s too late to go back now.\n\r\rA different key is used for tracks carry content with different value (e.g. 4K quality is more valuable than SD quality) or different decoder paths (audio versus video). For example, a typical movie might use the following set of keys:\n SD video key HD video key UHD video key audio key  After encrypting the samples, the CMAF header and segment header are extended with encryption-relevant information6. The DASH and HLS manifest are annotated, at minimum, with the KID of each track. Often, DRM client initialization data is also added to the manifests.\nEmbedded initialization data A player needs to provide initialization data to a DRM client in order to activate it. The format of this data is specific to the DRM technology but is typically based on the pssh format defined by Common Encryption4.\nDRM client initialization data is embedded into the DASH and HLS manifests for every DRM technology that the solution integrates with at the time of content processing. The manifest files can be easily extended with more initialization data when additional DRM technologies are integrated into a solution.\n\rHistorically, initialization data was embedded into the CMAF header instead of manifest files but this approach is deprecated due to maintenance problems it caused - it is much harder to change the CMAF header if you need to replace or extend the DRM initialization data.\r\r\rHere is an example of PlayReady and FairPlay initialization data for the same KID, in DASH format for PlayReady and HLS format for FairPlay. PlayReady uses the pssh format, whereas FairPlay uses a URL-like initialization data format:\n\u0026lt;ContentProtection value=\u0026quot;MSPR 2.0\u0026quot; schemeIdUri=\u0026quot;urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95\u0026quot;\u0026gt;\r\u0026lt;cenc:pssh\u0026gt;AAAB5HBzc2gAAAAAmgTweZhAQoarkuZb4IhflQAAAcTEAQAAAQABALoBPABXAFIATQBIAEUAQQBEAEUAUgAgAHgAbQBsAG4AcwA9ACIAaAB0AHQAcAA6AC8ALwBzAGMAaABlAG0AYQBzAC4AbQBpAGMAcgBvAHMAbwBmAHQALgBjAG8AbQAvAEQAUgBNAC8AMgAwADAANwAvADAAMwAvAFAAbABhAHkAUgBlAGEAZAB5AEgAZQBhAGQAZQByACIAIAB2AGUAcgBzAGkAbwBuAD0AIgA0AC4AMAAuADAALgAwACIAPgA8AEQAQQBUAEEAPgA8AFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBFAFkATABFAE4APgAxADYAPAAvAEsARQBZAEwARQBOAD4APABBAEwARwBJAEQAPgBBAEUAUwBDAFQAUgA8AC8AQQBMAEcASQBEAD4APAAvAFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBJAEQAPgBKAFEAegBJACsAQQA5AHAATgBrAGUAQgBNAGsATQBPAFgARwBtAFUAegBnAD0APQA8AC8ASwBJAEQAPgA8AC8ARABBAFQAQQA+ADwALwBXAFIATQBIAEUAQQBEAEUAUgA+AA==\u0026lt;/cenc:pssh\u0026gt;\r\u0026lt;/ContentProtection\u0026gt;\r #EXT-X-SESSION-KEY:METHOD=SAMPLE-AES,URI=\u0026quot;skd://f8c80c25-690f-4736-8132-430e5c6994ce:51BB4F1A7E2E835B2993884BD09ADB19\u0026quot;,KEYFORMAT=\u0026quot;com.apple.streamingkeydelivery\u0026quot;,KEYFORMATVERSIONS=\u0026quot;1\u0026quot;\r Initialization data is obviously unique for each DRM technology but also for each key, because it typically contains the KID. Because of this, initialization data can make up a surprisingly large portion of a manifest file.\nIt is most common to provide initialization data as part of the configuration for the content packager that performs the encryption. Different packagers accept configuration in different ways (some even use a hybrid push-pull model to retrieve different parts of the configuration in different ways). No matter how the configuration is defined the end result is the same: DRM initialization data is given to the packager by an external system.\n\rUnique initialization data is associated with each key and each DRM technology\r\r\rSome content packagers, however are capable of generating DRM initialization data on their own. This can lead to significant simplification in the backend workflows. You should use this capability whenever possible.\n\rIn many cases, the packager can simply generate DRM initialization data if it knows what DRM technologies are to be used\r\r\rInitialization data is legacy Other than to provide initialization data, there is no reason the content processing workflow even needs to know what DRM technologies will be used with the content! The requirement to embed this data into the manifests complicates data flows and often does so needlessly. Reducing unnecessary interactions in DRM workflows is a critical part of making it simple to integrate DRM into a solution, so this requirement is best eliminated.\nDRM initialization data is a mechanism for configuring DRM client behavior. It exists because there used to be no APIs that players could use to communicate with a DRM client - any configuration of DRM client behavior had to be done by embedding a DRM technology specific blob into the video itself. Later, this blob moved into the manifest files for easier manipulation. Today, the times have changed and modern DRM clients do offer APIs (e.g. Encrypted Media Extensions7 and equivalents). As a result, DRM initialization data often contains no information of value. Yet it persists in the APIs and workflows as an artifact of history.\nIn principle, providing DRM initialization data in the manifest files is optional - the initialization data could be acquired through other means by the player or even generated on the fly. Unfortunately, few players currently implement DRM client activation without embedded initialization data.\nIn short, the initialization data is typically just a DRM technology specific way to represent the KID. If possible, use players that can generate DRM client initialization data on the fly - by separating DRM technologies from your content pipeline you will achieve a more robust and maintainable solution architecture.\n\rThe player can generate DRM initialization data and greatly reduce content processing complexity and simplify interactions in DRM workflows\r\r\rDRM client initialization data is specific to each DRM technology and to each key. As such, a unique instance of the initialization data is embedded into the DASH and HLS manifests for each key used to encrypt the movie and for each DRM technology the movie is to be used with. A movie with a typical set of 4 keys, used with 3 DRM technologies, would have 4x3=12 instances of DRM initialization data embedded into it. By generating initialization data at runtime, you also benefit from minimizing the size of the manifest files, leading to greater efficiency, especially in live scenarios where the manifest must be refreshed periodically.\nWhat is encrypted? Audio and video tracks are encrypted. Text tracks (subtitles) are not.\nText tracks are technically equivalent to audio and video tracks but are entirely ignored in this series of articles because in practice they are never encrypted nor protected by DRM.\nWhat requires configuration? It can be confusing to tell the difference between what part of the encryption process is handled automatically by media processing products or services and what must be explicitly configured by an operator.\nThere is no straightforward answer as the details depend on the exact products and services used to perform the encryption - if you use very low-level media processing tools you may need to provide low level details, whereas if you use a fully automated publishing pipeline then you might not need to do anything at all.\nConsult with an expert to determine the appropriate setup for your specific situation.\nComing up next Having encrypted the samples and embedded DRM client initialization data, the content is ready to be served. The next article will take a look at the duties of the DRM client.\nKey management and other DRM-relevant data flows in the content pipeline will be covered in a separate article.\n  \rISO/IEC 23009-1:2019 (MPEG-DASH) \u0026#x21a9;\u0026#xfe0e;\n \rRFC 8216 and HTTP Live Streaming (Apple) \u0026#x21a9;\u0026#xfe0e;\n \rISO/IEC 23000-19:2020 (MPEG-CMAF) \u0026#x21a9;\u0026#xfe0e;\n \rISO/IEC 23001-7:2016 (Common Encryption) \u0026#x21a9;\u0026#xfe0e;\n \rHow many ways are there to sort GUIDs? How much time do you have? \u0026#x21a9;\u0026#xfe0e;\n \rDASH-IF Implementation Guidelines: Content Protection and Security (8.1 Content protection data in CMAF containers) \u0026#x21a9;\u0026#xfe0e;\n \rW3C Encrypted Media Extensions \u0026#x21a9;\u0026#xfe0e;\n   ","date":1588896000,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1588896000,"objectID":"916e029a6d8e3410ef176cde28b77c99","permalink":"/post/drm-is-not-a-black-box-02/","publishdate":"2020-05-08T00:00:00Z","relpermalink":"/post/drm-is-not-a-black-box-02/","section":"post","summary":"The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies.","tags":[],"title":"DRM is not a black box, part 2: encryption and content","type":"post"},{"authors":["Sander Saares"],"categories":["media streaming","content security","DRM is not a black box"],"content":"Apps, websites and services presenting high value video content use DRM technologies to prevent the viewer from making copies of the content. It can be surprising to learn that the website operator is not the one who ultimately benefits from DRM.\nThe past twelve years of my work on media streaming projects and products have kept me in close contact with DRM. This is the first in a series of articles that will briefly explain how the DRM ecosystem functions, in the hope that this will help lift a needless veil of secrecy that surrounds the topic. There is no need to work in the shadows when it comes to DRM - the techniques and mechanisms used should be well understood by all stakeholders to ensure that they are put to the best use.\nContent licensing A typical company that intends to publish a media streaming solution will first encounter DRM when they try to license some content to offer their viewers. Early in the negotiations, the content provider presents the solution operator with a security questionnaire to fill out. This will include questions both open-ended and highly specific, such as:\n What is your security model? Do you enforce removal of content from viewers whose subscription has lapsed? Does your solution detect jailbroken devices? If yes, how? What is the maximum video resolution you support for each platform you target? Which certificates are used for authenticity verification and who signs them? Does it depend on type of device? If so, how? Does yous solution offer protection against malicious system operators making unauthorized copies? If so, how? Which DRM technologies are used?  There can be as many as 20 pages of questions to answer and forms to fill, the purpose of which is to provide the content provider\u0026rsquo;s security experts the information they need to evaluate the solution\u0026rsquo;s content security capabilities. The security questionnaire is not a requirements list. A solution does not need to answer \u0026ldquo;yes\u0026rdquo; to every question and to deploy every mechanism listed.\n\rContent licensing relationships\r\r\rThe level of security provided by the solution is evaluated against the policy defined by the content provider to determine what content can be licensed for use in the solution. A solution that provides better security guarantees will unlock the possibility to license more valuable content.\n\rThe term \u0026ldquo;content owner\u0026rdquo; refers to the rights holder. However, most content owners license content directly only to very large customers. This means that in practice content is licensed from an intermediary, often together with post-processing, encoding and/or metadata services, here referred to as content provider.\nThe content owner is ultimately the one who decides the policy associated with a title but in many cases the solution builder never interacts directly with them, all daily interactions being with the content provider.\n\r\rDifferent titles have different security requirements:\n 4K resolution superhero movies tend to be the most valuable content - very few solution operators can offer security strong enough to license such content. This requires hardened devices and a supply chain where every link is secure and traceable. Early-window content (still playing in cinemas) has fairly high requirements but these can be met by most serious solution operators that have control over the full chain of systems involved in the solution. Anything already available of DVD has quite low requirements, as DVDs can be trivially copied. Library content (e.g. movies 10 or more years old) has minimal requirements, often being available even without the use of DRM technologies.  While the main basis for the decision is the earning potential of the title for the content owner, technical factors can still have an impact. For example, high-value content can be authorized for playback in less than ideal solutions if presented only at low quality levels (SD resolution).\nThe questions and answers are not the security model Ten years ago it was common to see the security questionnaires treated as \u0026ldquo;write-only\u0026rdquo; information in large part - as long as you answered the questions with what sounded like reasonable answers, you got the content. Nowadays, the depth of evaluation has increased and there are actual security experts reviewing the questionnaires in detail. If the text tries to be vague and lacks sufficient depth then additional rounds of inquiry are scheduled and pointed questions are raised to uncover the reasons for the vagueness.\nThis means that it is no longer easy to get away with just filling in convincing-sounding individual answers - the solution architect needs to present a complete set of responses that will convince the security expert reading the text that content security is a core part of the solution. The big picture presented by the answers is a significant component in the security expert\u0026rsquo;s evaluation. Treating the questionnaire as a list of checkboxes to tick will result in less access to content than one would obtain by presenting a thought-out security model that has meaning also outside the security questionnaire.\nThere can be a vast difference between the architecture and functioning of a solution designed to handle high-value content and of a solution designed without security principles in mind. It can be quite expensive to retrofit security into a solution if the need is only discovered at a late stage when a content provider security review raises painful questions. Content security should be built into a solution from the start.\nWhat is the role of DRM? The content licensing process is where a typical solution architect will first encounter DRM, with the first question being \u0026ldquo;which DRM technology is used\u0026rdquo;. A typical solution operator publishing content made by other parties will not care about DRM for their own benefit - viewers tend to be rule-abiding customers and even if a few individuals make unauthorized copies the business will not be impacted much. However, content owners care deeply about each and every time their content is accessed because a single unauthorized copy is enough to have a large impact across the entire viewership!\nTherefore, the usual thinking with regard to DRM is \u0026ldquo;what will satisfy the content owner\u0026rdquo; and not \u0026ldquo;what do I gain from DRM\u0026rdquo;. Most solution operators see DRM integration as a tax they have to pay in order to obtain content. One of the main goals for this series of articles attempts to reduce the budren of implementing DRM by helping solution architects new to DRM to understand the processes involved.\nEach content owner has a list of DRM technologies they have approved for use with thier content. The most common in use today are:\n Google Widevine - available on Android, Chrome, Firefox, Edge and various consumer electronic devices Microsoft PlayReady - available on Windows, Edge and many consumer electronic devices Apple FairPlay - available on Apple devices  These three are the core technologies of the DRM ecosystem and are approved for use by all content owners.\n\rThe 2019 China-US trade sanctions block Chinese manufacturers from using DRM technologies of US-based companies. As a result, Huawei Wiseplay DRM is likely to become a prominent DRM technology in the near future.\r\r\rNearly all modern consumer electronic devices include at least one native DRM technology implementation. Devices designed specifically for content playback, such as a smart TV or video-dongle, will typically support both Widevine and PlayReady, plus a few lesser known DRM technologies.\nBeyond the big three, there are several other DRM technologies that are also approved by many content owners but typically they are used less often as they are not natively supported by most devices and software platforms, requiring the use of plugins and specialized player apps.\nTechnical components of DRM technologies Obviously, there is some DRM code that must run on a viewer\u0026rsquo;s device in order to perform the functions expected of a DRM technology - that is, to stop the content from being copied. How this DRM client is delivered and how it integrates with the device\u0026rsquo;s capabilities can be quite different for each technology and each device.\nThree models are common for deploying DRM clients to viewer devices:\n The DRM client is part of the operating system and/or hardware. The DRM client is part of the web browser. The DRM client is part of the app.  A single DRM technology can exist in multiple forms depending on the target platform. For example, Google Widevine is part of the Android operating system, part of the Chrome, Firefox and Edge browsers, and can be deployed as part of an app on certain other platforms.\nThe capabilities available to each type of DRM client implementation are different. A DRM client integrated into the operating system and/or hardware can take advantage of access control mechanisms that are simply not exposed to browsers or apps, while at the same time protecting itself against attack using more powerful means. The measure of how well a DRM client resists attack is termed robustness - using a more robust implementation will convince a content provider to license you more valuable content.\n\rSimplified view of the basic DRM interactions\r\r\rIn addition to the DRM client on the viewer\u0026rsquo;s device, another DRM component runs as a backend service accessed over the network. To authorize usage of content, a document called a license is generated by the DRM server. This delivers the keys to unlock content, informs the device-side component how it must protect the content and defines under which conditions the viewer is authorized to access it (e.g. time limit, max display resolution). Each DRM technology produces the license using its own proprietary data format and uses a custom communication protocol to provide it to the device-side component.\nBeyond the interactions relevant to playback, DRM technologies are often also involved in the processing and preparation of the content. The data inside media streams is encrypted to ensure that it cannot be accessed without the cooperation of the DRM client, which is the only element permitted to obtain the key (as part of the license). Furthermore, DRM technology specific activation data is often embedded into the media stream headers to instruct the player on which DRM client to activate and how.\nThe management of encryption keys is often also a proprietary solution tied to the DRM server, although its exact forms vary greatly and no single approach has a strong foothold in the DRM ecosystem. Future articles in this series will explore the backend workflows in depth.\nMulti-DRM is mandatory There is no single DRM technology that covers all platforms. For reasons described in future articles, a solution operator will often want to use the native DRM technology offered by a platform even if other options exist.\nAs a result, a typical solution will need to use multiple DRM technologies, each targeting a specific set of platforms. This is a multi-DRM scenario.\nDifferent DRM technologies are completely independent from each other and only in recent years did the use of the same content files with different DRM technologies become feasible, due to all major DRM technologies starting to support the same encryption scheme. There are significant differences in the workflows, APIs and architectural patterns used with different DRM technologies. There are even significant and hidden differences in how different devices implement the same DRM technology! And of course, there are different versions of DRM technologies and different implementations of those technologies. It can be a major challenge to understand how exactly multiple DRM technologies can be effectively tied together in a single solution.\n\r\rA typical multi-DRM scenario with only two DRM technologies. Simplified scenario - many DRM interactions omitted to keep diagram readable. Click to zoom.\r\r\rLater articles in this series will examine in detail the interactions between different DRM technologies to explain how multi-DRM integration in a solution can be accomplished with minimal hassle.\nMulti-DRM is unnecessary The primary function of a DRM technology is to restrict what the viewer can do with the content. Typically, the viewer is authorized to play back the content (often within a time limit) but not to make copies of the content.\nAnd that\u0026rsquo;s it. That\u0026rsquo;s what every DRM technology aims to do. The core function is to restrict the viewer\u0026rsquo;s actions while resisting tampering by a viewer who does not like the imposed restrictions.\nDifferent DRM technologies largely accomplish this goal in very similar ways, with the differences between the DRM technologies coming down to proprietary protocols, data formats, SDKs and platform integration. From a solution operator\u0026rsquo;s perspective, there is zero need for multiple DRM technologies to exist. The fact that many different DRM technologies exist and continue to be relevant is largely explained by it being a matter of cost on two fronts:\n Someone once made an investment that first rooted a particular DRM technology on some platform and there was never enough justification to change it, as it worked well enough and switching to alternatives would have caused extra cost. It can be cheaper for a platform developer to integrate their own DRM technology than to license and adapt a 3rd party DRM technology. Sure, it might make life more expensive for solution operators by requiring multi-DRM but that is not a cost the platform developer has to pay.  Reducing the needless diversity and complexity of competing DRM technologies is in the interest of every solution operator. A platform developer only has to pay the price of DRM integration once but every solution operator has to pay the price of multi-DRM integration for every solution they deploy and every platform they target.\nUnfortunately, solution operators do not have much of a voice in the industry bodies that have leverage over platforms by defining industry standards - typically the companies defining the standards are the same ones that are implementing them, not the ones who have to actually use the result. As such, industry standards are often reduced to standardizing the status quo.\nComing up next \rThe next article will explore the technical sturcture of content used with modern DRM technologies and walk you through the steps and DRM interactions required to bring content into this form.\n","date":1588291200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1588291200,"objectID":"0a742efdae01a17db4f35eca00deb82a","permalink":"/post/drm-is-not-a-black-box-01/","publishdate":"2020-05-01T00:00:00Z","relpermalink":"/post/drm-is-not-a-black-box-01/","section":"post","summary":"Apps, websites and services presenting high value video content use DRM technologies to prevent the viewer from making copies of the content. It can be surprising to learn that the website operator is not the one who ultimately benefits from DRM.","tags":[],"title":"DRM is not a black box, part 1: why would you use DRM","type":"post"},{"authors":["Sander Saares"],"categories":["content security","standards"],"content":"The World Wide Web Consortium has recently made a decision to publish Encrypted Media Extensions (EME) as a web standard. This has drawn criticism from many directions because EME standardizes a mechanism that is highly opaque to users, has the potential to jeopardize their privacy and brings considerable legal risk to any researchers that try to study it.\nDespite this, EME is a step up in interoperability and has incorporated basic privacy-oriented features that were lacking in pre-EME technologies. To better understand what EME truly brings to users, one needs to understand not only what it is but also where it comes from and what future directions it and related technologies may take.\nWhat exactly are DRM and EME? Studios that license premium content require video solutions to use Digital Rights Management systems (DRM) that enforce strict control over what users can do with the content. Premium content is delivered to users in encrypted form, ensuring that even if the data is intercepted and copied, it cannot be played back without the required key. Each player must cooperate with a DRM system — a component of the user’s device — that is tasked with obtaining and protecting this key and ensuring that the decrypted content can only be displayed for immediate viewing and not copied.\n\r\rEME defines an API and various data structures, often used merely to wrap DRM system specific data.\r\r\r\rEME is an API that defines standard functions and data structures that can be called form JavaScript in order to activate the DRM system used by the browser and to supply it with data. It does not standardize how DRM systems protect content or keys, or even how they obtain those keys and allow them to be used. Most of the actual messaging involved remains DRM system specific and is simply wrapped by EME data structures. EME provides an on-switch and a feedback mechanism to allow the DRM system to inform the web page about the presence or absence of keys. DRM in the world before EME\nThe concept of DRM has been around for decades, gaining significant uptake in the 80s and 90s in cable and satellite television and then spreading to personal devices like the iPod and Zune. It is from here that it made the leap to the web browser when Microsoft published the Silverlight 2.0 plugin in 2008, taking Zune’s PlayReady DRM technology along for the ride. Silverlight was promoted heavily and reached an installed base of around 70% in a few years.\nAs Silverlight was available not only for Internet Explorer but also for other browsers and even on Mac OS, it presented a very attractive target for solution developers who wanted to offer their customers the ability to play back premium content. Companies like Netflix were quick to take advantage of this capability. Suddenly, even small independent solutions could ensure that playback was protected and thereby license content from serious movie studios.\nOther companies quickly piled on to take a bite of this fast developing market opened by Microsoft, with Flash integrating DRM support and various other vendors offering their own browser plugins for DRM-enabled playback. Their approaches to business were quite different and video playback technologies were at the same time evolving in other ways that lead to a slow uptake of alternative DRM systems, causing Microsoft to come out more or less on top of the browser DRM game. Still, the era of browser plugins was ending and Silverlight usage quickly declined as HTML 5 made the web more unified and presented a convenient alternative to plugin-based rich web app development. Yet for a long time there was no serious alternative for DRM and video playback remained a plugin-driven activity far into the HTML 5 age.\nIn hindsight, we can say that browser plugins were a particularly buggy phenomenon — think of the endless security vulnerabilities of Flash. The concept of regularly updating browser plugins never really reached the majority of users who as a result were often using outdated software. Furthermore, plugins were completely opaque to the users — a plugin was a black box, providing whatever functionality its authors decided to include. There was nobody advocating for the rights of users in this arrangement — you had to click the install button and accept whatever came or you had to move on and not consume content on your desired website.\nThe system worked despite its flaws and it was the best that the industry could provide in its day. However, plugins endangered users’ computers and caused frustration for solution developers who had to not only convince users to install buggy plugins but then also had to support those users when they inevitably ran into issues. As competing DRM technology stacks were completely incompatible with each other and no single one covered all platforms and device types, ambitious solution developers often had to set up multiple parallel content delivery flows to serve a wide range of platforms, making it expensive to offer premium content to a wide range of users.\nHow EME was born In the early 2010’s it quickly became apparent to many in the industry that with the decline of browser plugins an alternative was needed to ensure that premium content could still be provided to users. If there is no plugin the only thing left is the browser. Yet before tackling the hard topic of DRM, another needed attention. Not only were the browser plugins responsible for DRM but also the actual playback of content, using modern adaptive streaming technologies that could adjust the playback experience according to the the user’s internet connection capabilities. This could not be done by the browsers, which were only capable of playing back simple MP4 files, if that.\nThe first technology to be standardized was Media Source Extensions which defined a mechanism for the web page to directly feed content to the browser’s media engine. The browser took on the complexity of decoding and rendering media and of making use of the device’s hardware acceleration features, none of which could be feasibly done by the JavaScript code running in a web page. This was largely uncontroversial and opened the door to begin standardization of DRM related features along similar lines.\nAs work on Encrypted Media Extensions started it quickly became apparent to many observers that not all participants really understood DRM. This caused significant friction and never truly went away, with different parties approaching the topic from very different viewpoints and some harboring rather unfortunate misunderstandings of what exactly was being worked on. User privacy has been a topic raised time and time again, yet companies implementing EME are often happy with the status quo as they have a conflict of interest in maintaining their DRM technologies that often rely on obfuscation and secrecy to provide security. Firefox developers have stood out at times by speaking up about the rights of users in the W3C working group. Unfortunately, the very same Firefox developers have often been relatively uninformed about the DRM market, making their efforts ineffective.\nWeb standards are usually developed in parallel with implementations and EME was no different. Two major browser manufacturers — Microsoft and Google — each had their own DRM technology and they were eager to get it on the market in a widely usable form. While discussions were ongoing, their browsers implemented what seemed to be the most sensible opinion of the day and sometimes created custom API extensions where there was no EME-provided solution. There came a point in the EME standardization process where the two major browser families had working DRM implementations accessible by EME with the core features implemented in a way essentially compatible with EME. Motivation to continue the standardization quickly declined and for a long time around 2015–2016 EME standardization became something of a purely theoretical exercise, with implementations already in active use in forms resembling various drafts of EME.\nThings never really changed after that — the more advanced features were dropped from EME due to lack of implementations (required for standardization). Browser authors did not see the point in implementing more EME features as solution developers appeared quite happy to make do with what was already there. In the final stretch of standardization, there has been a slow trickle of convergence but the possibility for EME to drive browser feature development in the field of DRM is largely gone. I suspect this is one of the main reasons why W3C is going ahead with standardization — EME in practice has been a done deal for a year or two already. It is in widespread use and blocking standardization will not get rid of EME or change what browsers do. In many ways, EME survives at the mercy of browsers, not the other way around.\nOpening the market for competition Behind the scenes, Netflix was the major driving force that motivated platform developers to incorporate readily available media technologies into their browsers and consumer devices. The wave of standardization was largely driven by their massive success in online video. The content pieline — processing, delivery, playback and protection — has always been a massive cost center for solution developers and the lack of standardization often forced companies (that could afford it) to maintain multiple parallel workflows to serve different platforms utilizing different technologies. Platforms that supported standard mechanisms could get a Netflix presence very easily, thereby motivating smaller platforms by enabling them to offer familiar services to users and larger platforms by creating competition.\nWhile some browsers are created by companies who are also DRM technology developers, others are not. One thing that EME standardizes is the ability for the web page to choose a DRM system from multiple options presented by the browser. This enabled Firefox to create some welcome competition in the DRM market, dominated by software giants Microsoft and Google, when Firefox chose to integrate Adobe’s DRM technology. As it turned out, Adobe never succeeded with DRM due to their sales approach that consisted of only going for the largest customers. A few years down the line, Google stepped in to integrate their Widevine DRM technology into Firefox, as an option more accessible to solution developers. Thus the availability of premium content for Firefox users was greatly increased, enabling the browser to remain competitive. At the same time, choices in DRM systems were again reduced by the lack of Adobe’s commercial success in the field of DRM.\nSome platforms such as Chromecast and many Android devices incorporate multiple DRM technologies out of the box and expose them using EME or an equivalent non-browser technology, enabling not only competition between browsers and platforms but also between different DRM technology providers. Five years ago, each DRM technology provider took a royalty payment whenever their technology was used to deliver a decryption key. Today, all major DRM technologies are royalty-free in this regard — largely due to the competition encouraged by the wide uptake EME.\nFuture opportunities DRM systems remain opaque to users — while EME standardizes the mechanism of activating them, it does not affect what DRM systems actually do. Users have little to no control or visibility over the information collected by DRM systems or the rights that are assigned to them. DRM remains a boolean factor that simply determines whether a video plays back or does not. Any information exposed to the user comes from the website they use, which often says nothing about DRM. Indeed, the user may not even be aware that there is a component in his device that is actively working to protect data from the device’s owner.\nIncreased competition in the field of DRM system development is the best hope for achieving more results in this area. If users are able to select the DRM technologies they wish to use, competition may force DRM system authors to accept privacy-oriented standardization. EME opens the door for choice between DRM technologies, though few platforms actually enable a choice to be made as most only implement a single DRM technology.\nEven when there is a choice of DRM technologies, the decision is made by the solution developer, based on what technology is preferred by them. This is largely driven by technological needs — remember that EME only standardizes the mechanism of DRM system activation. There is nothing even remotely standardized about key management workflows and digital rights policy application. These are closely guarded secrets of DRM technology authors. While differentiation between DRM systems cannot and should not be avoided — it is the differences in technologies that drive competition, after all — this secrecy about the related proprietary formats for key delivery and policy control is mostly meaningless and simply driven by inertia and lack of a reason to do it any different. 99% of the currently-secret communication protocols and formats could be opened for standardization without and loss of security in terms of content protection.\nIt is here that the needs of solution developers overlap with the needs of users — for developers, having to work with different DRM technologies causes needless duplication. Many companies with DRM experience create their own generic abstractions over DRM technologies that enable their solutions to work with them all using a single unified interface. From here, there is only a short leap toward true standardization of DRM protocols. This topic has been raised both in W3C and in private industry forums several times but in every instance the drive to act dissipates as it quickly becomes clear to us that nobody with enough pull in the industry (i.e. the DRM technology providers) would actually implement any of it.\nA lack of motivation to implement standards is the major factor we need to overcome if we are to open up DRM for the world. Competition is what forces companies to act and EME has done a good job of bringing a small bit of competition to the web by enabling different parties to make use of DRM with reduced development effort. It is by increasing this competition in new ways that we can drive further actions. Writing standards motivated by noble goals of interoperability or the protection of user rights is not enough — companies need to to put their money behind implementing the standards and that will only happen if they have something to gain from it. In the end, DRM is a mechanism that enables solution providers to attract more users by enabling premium content playback and this is the lever that can move the industry.\n","date":1499990400,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1499990400,"objectID":"5fc670063397f236236ec7192118a0c8","permalink":"/post/drm-in-html/","publishdate":"2017-07-14T00:00:00Z","relpermalink":"/post/drm-in-html/","section":"post","summary":"The World Wide Web Consortium has recently made a decision to publish Encrypted Media Extensions (EME) as a web standard. This has drawn criticism from many directions because EME standardizes a mechanism that is highly opaque to users, has the potential to jeopardize their privacy and brings considerable legal risk to any researchers that try to study it.","tags":[],"title":"DRM in HTML: what EME has and has not done for us","type":"post"},{"authors":["Sander Saares"],"categories":["media streaming","standards"],"content":"Apple announced today the support for fragmented MP4 segments in HTTP Live Streaming (HLS), taking the first step in bringing together the two competing adaptive streaming universes that exist today: HLS and DASH. The former is the premier media delivery technology on Apple products while the latter is implemented on all other modern platforms.\nThere are two main differences between the two, which has meant that creating two different variants of every piece of content has been unavoidable in order to serve both Apple and non-Apple players. The key aspects are:\n The media segment format – which until today had been MPEG-TS for HLS and MP4 for DASH1. The encryption scheme – AES-CBC for HLS and AES-CTR for DASH.  Today\u0026rsquo;s move by Apple eliminates the first difference, enabling the same segment format to be used for both DASH and HLS content. To present content without encryption in both adaptive streaming universes can now be accomplished by simply generating two kinds of manifest files for the exact same media segment files! This provides great savings in disk space, media processing complexity and delivery architecture.\nWhat still remains is the obstacle of differing encryption formats. While both HLS-with-MP4 and DASH use Common Encryption, this is merely an umbrella term for multiple different and incompatible encryption schemes. The day when encrypted content can be shared between HLS and DASH remains in the future.\n  While Apple contributed to DASH in its early days, this ended up merely leading to the creation of two \u0026ldquo;flavors\u0026rdquo; of DASH – one of which was very Apple-specific and not used by anyone for anything much. When people today speak of DASH they speak of the other, MP4-based variant of DASH. \u0026#x21a9;\u0026#xfe0e;\n   ","date":1466035200,"expirydate":-62135596800,"kind":"page","lang":"en","lastmod":1466035200,"objectID":"8d150889324291cfe4a3e60a531fd928","permalink":"/post/converging-on-cmaf/","publishdate":"2016-06-16T00:00:00Z","relpermalink":"/post/converging-on-cmaf/","section":"post","summary":"Apple announced today the support for fragmented MP4 segments in HTTP Live Streaming (HLS), taking the first step in bringing together the two competing adaptive streaming universes that exist today: HLS and DASH.","tags":[],"title":"Closing in on a common media application format","type":"post"}]