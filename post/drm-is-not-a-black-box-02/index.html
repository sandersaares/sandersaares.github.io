<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Sander Saares">

  
  
  
    
  
  <meta name="description" content="The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies.">

  
  <link rel="alternate" hreflang="en-us" href="/post/drm-is-not-a-black-box-02/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/drm-is-not-a-black-box-02/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@sandersaares">
  <meta property="twitter:creator" content="@sandersaares">
  
  <meta property="og:site_name" content="Sander Saares">
  <meta property="og:url" content="/post/drm-is-not-a-black-box-02/">
  <meta property="og:title" content="DRM is not a black box, part 2: encryption and content | Sander Saares">
  <meta property="og:description" content="The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies."><meta property="og:image" content="/post/drm-is-not-a-black-box-02/featured.png">
  <meta property="twitter:image" content="/post/drm-is-not-a-black-box-02/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-05-08T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-05-08T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/drm-is-not-a-black-box-02/"
  },
  "headline": "DRM is not a black box, part 2: encryption and content",
  
  "image": [
    "/post/drm-is-not-a-black-box-02/featured.png"
  ],
  
  "datePublished": "2020-05-08T00:00:00Z",
  "dateModified": "2020-05-08T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Sander Saares"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Sander Saares",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies."
}
</script>

  

  


  


  





  <title>DRM is not a black box, part 2: encryption and content | Sander Saares</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Sander Saares</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Sander Saares</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Home</span></a>
        </li>

        
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>DRM is not a black box, part 2: encryption and content</h1>

  
  <p class="page-subtitle">Encryption is the tool that enables DRM</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/sandersaares/">Sander Saares</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    May 8, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    12 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/media-streaming/">media streaming</a>, <a href="/categories/content-security/">content security</a>, <a href="/categories/drm-is-not-a-black-box/">DRM is not a black box</a></span>
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 698px; max-height: 326px;">
  <div style="position: relative">
    <img src="/post/drm-is-not-a-black-box-02/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>The internet is the birthplace of modern DRM. Even if you deploy an offline solution with local playback, DRM technologies operate with least hassle when your solution uses modern adaptive streaming technologies. A content processing workflow designed for adaptive streaming is a content processing workflow ready for DRM.</p>
<p>The two media delivery technologies of relevance here are DASH<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> and HLS<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>. The Apple ecosystem uses HLS, whereas everything else uses DASH. In order to understand encryption, you need to understand how content is structured when using these technologies.</p>
<div class="alert alert-note">
  <div>
    Other lesser known delivery technologies are occasionally used by some vendors. However, these alternative technologies are insignificant in the big picture and their use only leads to vendor lock-in and excessive cost. Use DASH and HLS.
  </div>
</div>
<h1 id="structure-of-dash-and-hls">Structure of DASH and HLS</h1>
<p>Most solutions wish to target viewers on both Apple and non-Apple platforms and therefore need to present all content using both the DASH and HLS delivery technologies. Thankfully this is not as burdensome as it sounds because the two are in fact different flavors of the same thing.</p>
<p>The link between the two technologies is CMAF<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> (a cousin of the well-known MP4 file format) which defines a common format for media data storage compatible with both DASH and HLS. The latter two technologies define the format of the <strong>manifest</strong> files that contain instructions for players on how to access the content stored in the shared CMAF media files.</p>





  
  











<figure id="figure-relationships-between-dash-hls-and-cmaf">



  <img data-src="/post/drm-is-not-a-black-box-02/dash-hls-cmaf_huc0d1bf4dbd1d5fa403595f55ce6350b5_16661_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="405" height="287">



  
  
  <figcaption>
    Relationships between DASH, HLS and CMAF
  </figcaption>


</figure>

<p>DASH manifest files are served to DASH players, which will use the information within to load data from CMAF media files. HLS manifest files are served to HLS players, which will use the information within to load data from CMAF media files. As the bulk of the data is in the shared CMAF files, there is no duplication of storage costs or excessive CDN throughput despite using two different media delivery technologies.</p>
<div class="alert alert-note">
  <div>
    The contents of the HLS and DASH manifest files are quite similar and it is often easy to convert from one to the other. This means that a content processing workflow only capable of working with either DASH or HLS can be easily enhanced by post-processing to produce the other manifest format.
  </div>
</div>
<p>The audio and video data exists in the form of <strong>samples</strong>, where one sample is one video frame (e.g. 24 samples per second) or a similar duration of audio data. Samples are grouped into self-contained <strong>segments</strong> of 2-10 second duration, where each segment is independently presentable by players without having to reference data in any other segment. A <strong>CMAF header</strong> contains the technical parameters required for a decoder to process the data contained in the segments.</p>





  
  











<figure id="figure-structure-of-cmaf-media-data-storage">


  <a data-fancybox="" href="/post/drm-is-not-a-black-box-02/structure_hud23d80927c2dbf72f5510d55cb4f781d_16601_2000x2000_fit_lanczos_2.png" data-caption="Structure of CMAF media data storage">


  <img data-src="/post/drm-is-not-a-black-box-02/structure_hud23d80927c2dbf72f5510d55cb4f781d_16601_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="575" height="400">
</a>


  
  
  <figcaption>
    Structure of CMAF media data storage
  </figcaption>


</figure>

<p>Segments may either be stored in separate files or in one giant CMAF track file (effectively just a concatenated series of segments prefixed with the CMAF header). The storage format largely depends on workflow-specific configuration and content processing service compatibility - different services expect the data to exist in different forms.</p>
<h1 id="applying-drm-to-movies">Applying DRM to movies</h1>
<p>The media samples stored inside the CMAF files are encrypted. DRM technologies rely on encryption to control when and where the media data can be used for playback, creating situations where the decryption key is only provided to authorized DRM clients and only when all the necessary conditions to ensure adequate content protection are met.</p>
<p>Encryption is performed individually for each sample - it is not the files themselves that are encrypted but only the actual audio/video data within them. Even there, encryption is only partially applied - for video data only 10% of each sample is encrypted, leaving 90% in the clear. As the encryption is applied in a repeating pattern of 1:9 blocks, it is sometimes called <strong>pattern encryption</strong>. One block is 16 bytes.</p>





  
  











<figure id="figure-10-pattern-encryption-applied-to-data-in-video-samples">



  <img data-src="/post/drm-is-not-a-black-box-02/pattern-encryption_hu0aaf388355e1e6fea96100781571c40d_4597_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="504" height="383">



  
  
  <figcaption>
    10% pattern encryption applied to data in video samples
  </figcaption>


</figure>

<div class="alert alert-note">
  <div>
    The rationale for using pattern encryption is that encrypting 10% of the data is sufficient to make the samples unusable without the key while minimizing the impact of decryption on processor capacity and battery life. Audio samples are fully encrypted due to their relatively small size.
  </div>
</div>
<p>A small prefix of up to 32 bytes in each sample is typically left in the clear to enable sample headers to be processed. This technique of dividing a sample into clear and encrypted regions is called <strong>subsample encryption</strong>. For encryption algorithm purposes (e.g. where does the 10% pattern start) the clear prefix is considered not to be a part of the sample.</p>





  
  











<figure id="figure-subsample-encryption-leaves-an-optional-clear-prefix-to-expose-the-sample-headers">



  <img data-src="/post/drm-is-not-a-black-box-02/subsample-encryption_hu0afda73aaeaf539bab2ab42eece5ae8e_2803_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="503" height="212">



  
  
  <figcaption>
    Subsample encryption leaves an optional clear prefix to expose the sample headers
  </figcaption>


</figure>

<p>Subsample encryption is typically only used with video tracks and does not need to be configured by the operator - content processing tools that encrypt data already know when a clear prefix is required and will insert it automatically.</p>
<p>The technical details of encryption are described by the <code>cbcs</code> protection scheme defined in the Common Encryption<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup> standard. You may see material online referencing the <code>cenc</code> protection scheme but this scheme is effectively becoming obsolete as Apple devices do not support it. Modern devices use <code>cbcs</code>. In addition to cryptographic differences, the <code>cenc</code> protection scheme does not use pattern encryption but encrypts the entire sample.</p>
<div class="alert alert-warning">
  <div>
    If your target device set contains devices that do not support the <code>cbcs</code> protection scheme then you will need to create two copies of every encrypted track - one encrypted with <code>cbcs</code> (for Apple and newer non-Apple devices) and one with <code>cenc</code> (for older non-Apple devices).
  </div>
</div>
<p>After applying encryption the movie is safe for publishing over unprotected channels. You do not need to guard access to the files as the content cannot be accessed without the key. In some high-security scenarios, you might still care about protecting access to the files as part of a defense-in-depth strategy (e.g. by using URL signing to control who can download the files) but on a cryptographic level the sample data is now unusable for an attacker.</p>
<div class="alert alert-note">
  <div>
    All modern DRM technologies use the same encryption algorithms that are equally strong - there is no difference in the strength of encryption between DRM technologies. However, different DRM client implementations do have different strengths and weaknesses. This will be explored in depth by the <a href="../drm-is-not-a-black-box-03/">next article in this series</a>.
  </div>
</div>
<p>To apply encryption, you need to know the <strong>key</strong> and the <strong>key ID</strong> (or <strong>KID</strong>). The key is a 128-bit symmetric key (i.e. the same key is used for encryption and decryption). The KID is a separate (non-secret) 128-bit value used elsewhere in DRM workflows to reference a specific key. Key management is a large topic of its own, to be covered in a separate article.</p>
<p>Different data formats are used for representing keys and KIDs, depending on the situation and the specific piece of software. In practice, the KID is typically formatted as a GUID<sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup> (<code>a0a8db17-20c7-4068-bfbd-f8a68e34f1a5</code>) and the key as a base64 or hexadecimal string (<code>FSu0UIH8Z06IOyXVlnmc8Q==</code> or <code>0x152bb45081fc674e883b25d596799cf1</code>).</p>
<div class="alert alert-warning">
  <div>
    <p>GUIDs have multiple different binary representations! The &ldquo;Linux style&rdquo; binary format is acheived by removing the dashes and treating a GUID as a hexadecimal string. The &ldquo;Windows style&rdquo; binary format is achieved in a more complex fashion, with a different order of bytes.</p>
<p>Media streaming systems typically use the Linux style binary format. This has caused much pain when software platforms assume Windows style and developers only discover that 2 years into production when integrating another system that uses Linux style. In hindsight using GUIDs for KIDs was a mistake but it&rsquo;s too late to go back now.</p>
  </div>
</div>
<p>A different key is used for tracks carry content with different value (e.g. 4K quality is more valuable than SD quality) or different decoder paths (audio versus video). For example, a typical movie might use the following set of keys:</p>
<ol>
<li>SD video key</li>
<li>HD video key</li>
<li>UHD video key</li>
<li>audio key</li>
</ol>
<p>After encrypting the samples, the CMAF header and segment header are extended with encryption-relevant information<sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>. The DASH and HLS manifest are annotated, at minimum, with the KID of each track. Often, DRM client initialization data is also added to the manifests.</p>
<h1 id="embedded-initialization-data">Embedded initialization data</h1>
<p>A player needs to provide <strong>initialization data</strong> to a DRM client in order to activate it. The format of this data is specific to the DRM technology but is typically based on the <code>pssh</code> format defined by Common Encryption<sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</p>
<p>DRM client initialization data is embedded into the DASH and HLS manifests for every DRM technology that the solution integrates with at the time of content processing. The manifest files can be easily extended with more initialization data when additional DRM technologies are integrated into a solution.</p>
<div class="alert alert-note">
  <div>
    Historically, initialization data was embedded into the CMAF header instead of manifest files but this approach is deprecated due to maintenance problems it caused - it is much harder to change the CMAF header if you need to replace or extend the DRM initialization data.
  </div>
</div>
<p>Here is an example of PlayReady and FairPlay initialization data for the same KID, in DASH format for PlayReady and HLS format for FairPlay. PlayReady uses the <code>pssh</code> format, whereas FairPlay uses a URL-like initialization data format:</p>
<pre><code class="language-xml">&lt;ContentProtection value=&quot;MSPR 2.0&quot; schemeIdUri=&quot;urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95&quot;&gt;
  &lt;cenc:pssh&gt;AAAB5HBzc2gAAAAAmgTweZhAQoarkuZb4IhflQAAAcTEAQAAAQABALoBPABXAFIATQBIAEUAQQBEAEUAUgAgAHgAbQBsAG4AcwA9ACIAaAB0AHQAcAA6AC8ALwBzAGMAaABlAG0AYQBzAC4AbQBpAGMAcgBvAHMAbwBmAHQALgBjAG8AbQAvAEQAUgBNAC8AMgAwADAANwAvADAAMwAvAFAAbABhAHkAUgBlAGEAZAB5AEgAZQBhAGQAZQByACIAIAB2AGUAcgBzAGkAbwBuAD0AIgA0AC4AMAAuADAALgAwACIAPgA8AEQAQQBUAEEAPgA8AFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBFAFkATABFAE4APgAxADYAPAAvAEsARQBZAEwARQBOAD4APABBAEwARwBJAEQAPgBBAEUAUwBDAFQAUgA8AC8AQQBMAEcASQBEAD4APAAvAFAAUgBPAFQARQBDAFQASQBOAEYATwA+ADwASwBJAEQAPgBKAFEAegBJACsAQQA5AHAATgBrAGUAQgBNAGsATQBPAFgARwBtAFUAegBnAD0APQA8AC8ASwBJAEQAPgA8AC8ARABBAFQAQQA+ADwALwBXAFIATQBIAEUAQQBEAEUAUgA+AA==&lt;/cenc:pssh&gt;
&lt;/ContentProtection&gt;
</code></pre>
<pre><code class="language-text">#EXT-X-SESSION-KEY:METHOD=SAMPLE-AES,URI=&quot;skd://f8c80c25-690f-4736-8132-430e5c6994ce:51BB4F1A7E2E835B2993884BD09ADB19&quot;,KEYFORMAT=&quot;com.apple.streamingkeydelivery&quot;,KEYFORMATVERSIONS=&quot;1&quot;
</code></pre>
<p>Initialization data is obviously unique for each DRM technology but also for each key, because it typically contains the KID. Because of this, initialization data can make up a surprisingly large portion of a manifest file.</p>
<p>It is most common to provide initialization data as part of the configuration for the content packager that performs the encryption. Different packagers accept configuration in different ways (some even use a hybrid push-pull model to retrieve different parts of the configuration in different ways). No matter how the configuration is defined the end result is the same: DRM initialization data is given to the packager by an external system.</p>





  
  











<figure id="figure-unique-initialization-data-is-associated-with-each-key-and-each-drm-technology">



  <img data-src="/post/drm-is-not-a-black-box-02/initdata-on-packager_hu9fce4d5bd4b1a0b68c37623c02caf6dd_25433_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="664" height="407">



  
  
  <figcaption>
    Unique initialization data is associated with each key and each DRM technology
  </figcaption>


</figure>

<p>Some content packagers, however are capable of generating DRM initialization data on their own. This can lead to significant simplification in the backend workflows. You should use this capability whenever possible.</p>





  
  











<figure id="figure-in-many-cases-the-packager-can-simply-generate-drm-initialization-data-if-it-knows-what-drm-technologies-are-to-be-used">



  <img data-src="/post/drm-is-not-a-black-box-02/initdata-generated-on-packager_hu74e4a2f81fb78a90ec66acb0c5d7d6f1_25118_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="715" height="531">



  
  
  <figcaption>
    In many cases, the packager can simply generate DRM initialization data if it knows what DRM technologies are to be used
  </figcaption>


</figure>

<h1 id="initialization-data-is-legacy">Initialization data is legacy</h1>
<p><strong>Other than to provide initialization data, there is no reason the content processing workflow even needs to know what DRM technologies will be used with the content!</strong> The requirement to embed this data into the manifests complicates data flows and often does so needlessly. Reducing unnecessary interactions in DRM workflows is a critical part of making it simple to integrate DRM into a solution, so this requirement is best eliminated.</p>
<p>DRM initialization data is a mechanism for configuring DRM client behavior. It exists because there used to be no APIs that players could use to communicate with a DRM client - any configuration of DRM client behavior had to be done by embedding a DRM technology specific blob into the video itself. Later, this blob moved into the manifest files for easier manipulation. Today, the times have changed and modern DRM clients do offer APIs (e.g. Encrypted Media Extensions<sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup> and equivalents). As a result, DRM initialization data often contains no information of value. Yet it persists in the APIs and workflows as an artifact of history.</p>
<p>In principle, providing DRM initialization data in the manifest files is optional - the initialization data could be acquired through other means by the player or even generated on the fly. Unfortunately, few players currently implement DRM client activation without embedded initialization data.</p>
<p>In short, the initialization data is typically just a DRM technology specific way to represent the KID. <strong>If possible, use players that can generate DRM client initialization data on the fly - by separating DRM technologies from your content pipeline you will achieve a more robust and maintainable solution architecture</strong>.</p>





  
  











<figure id="figure-the-player-can-generate-drm-initialization-data-and-greatly-reduce-content-processing-complexity-and-simplify-interactions-in-drm-workflows">



  <img data-src="/post/drm-is-not-a-black-box-02/initdata-on-player_huae6841bf243854e3d25956f48bc90a75_15501_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="443" height="276">



  
  
  <figcaption>
    The player can generate DRM initialization data and greatly reduce content processing complexity and simplify interactions in DRM workflows
  </figcaption>


</figure>

<p>DRM client initialization data is specific to each DRM technology and to each key. As such, a unique instance of the initialization data is embedded into the DASH and HLS manifests for each key used to encrypt the movie and for each DRM technology the movie is to be used with. A movie with a typical set of 4 keys, used with 3 DRM technologies, would have 4x3=12 instances of DRM initialization data embedded into it. <strong>By generating initialization data at runtime, you also benefit from minimizing the size of the manifest files, leading to greater efficiency, especially in live scenarios where the manifest must be refreshed periodically.</strong></p>
<h1 id="what-is-encrypted">What is encrypted?</h1>
<p>Audio and video tracks are encrypted. Text tracks (subtitles) are not.</p>
<p>Text tracks are technically equivalent to audio and video tracks but are entirely ignored in this series of articles because in practice they are never encrypted nor protected by DRM.</p>
<h1 id="what-requires-configuration">What requires configuration?</h1>
<p>It can be confusing to tell the difference between what part of the encryption process is handled automatically by media processing products or services and what must be explicitly configured by an operator.</p>
<p>There is no straightforward answer as the details depend on the exact products and services used to perform the encryption - if you use very low-level media processing tools you may need to provide low level details, whereas if you use a fully automated publishing pipeline then you might not need to do anything at all.</p>
<p>
<a href="../../#contact">Consult an expert</a> to determine the appropriate setup for your specific situation.</p>
<h1 id="coming-up-next">Coming up next</h1>
<p>Having encrypted the samples and embedded DRM client initialization data, the content is ready to be served. 
<a href="../drm-is-not-a-black-box-03/">The next article will take a look at the duties of the DRM client</a>.</p>
<p>Key management and other DRM-relevant data flows in the content pipeline will be covered in a separate article.</p>
<p>
<a href="../../categories/drm-is-not-a-black-box/">View all articles in the series.</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>
<a href="https://www.iso.org/standard/79329.html" target="_blank" rel="noopener">ISO/IEC 23009-1:2019 (MPEG-DASH)</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>
<a href="https://tools.ietf.org/html/rfc8216" target="_blank" rel="noopener">RFC 8216</a> and 
<a href="https://developer.apple.com/streaming/" target="_blank" rel="noopener">HTTP Live Streaming (Apple)</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>
<a href="https://www.iso.org/standard/79106.html" target="_blank" rel="noopener">ISO/IEC 23000-19:2020 (MPEG-CMAF)</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p>
<a href="https://www.iso.org/standard/68042.html" target="_blank" rel="noopener">ISO/IEC 23001-7:2016 (Common Encryption)</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p>
<a href="https://devblogs.microsoft.com/oldnewthing/20190426-00/?p=102450" target="_blank" rel="noopener">How many ways are there to sort GUIDs? How much time do you have?</a> <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p>
<a href="https://dashif-documents.azurewebsites.net/Guidelines-Security/master/Guidelines-Security.html#CPS-cmaf-structure" target="_blank" rel="noopener">DASH-IF Implementation Guidelines: Content Protection and Security (8.1 Content protection data in CMAF containers)</a> <a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p>
<a href="https://www.w3.org/TR/encrypted-media/" target="_blank" rel="noopener">W3C Encrypted Media Extensions</a> <a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </div>

    





<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/drm-is-not-a-black-box-02/&amp;text=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/drm-is-not-a-black-box-02/&amp;t=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content&amp;body=/post/drm-is-not-a-black-box-02/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/drm-is-not-a-black-box-02/&amp;title=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content%20/post/drm-is-not-a-black-box-02/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/drm-is-not-a-black-box-02/&amp;title=DRM%20is%20not%20a%20black%20box,%20part%202:%20encryption%20and%20content" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/sandersaares/avatar_hub71303099b38f2f6cba13ac65c7c942f_84843_270x270_fill_q90_lanczos_center.jpg" alt="Sander Saares">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Sander Saares</a></h5>
      
      <p class="card-text">An expert in media streaming and content protection</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:sander@saares.eu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/sandersaares" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://stackoverflow.com/users/2928/sander" target="_blank" rel="noopener">
        <i class="fab fa-stack-overflow"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  





<section id="comments">
  
    <div id="commento"></div>

<script src="https://cdn.commento.io/js/commento.js" defer></script>

  
</section>






  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.8/mermaid.min.js" integrity="sha256-lyWCDMnMeZiXRi7Zl54sZGKYmgQs4izcT7+tKc+KUBk=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Sander Saares 2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
