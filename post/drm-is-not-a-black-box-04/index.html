<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Sander Saares">

  
  
  
    
  
  <meta name="description" content="Historical key managament approaches leave it all in the care of the DRM vendor, leading to major lock-in and maintenance headaches that can require solution re-architecting when DRM vendors are changed or added. A modern solution architecture separates key management from DRM and enables flexible integration of solution components from different vendors.">

  
  <link rel="alternate" hreflang="en-us" href="/post/drm-is-not-a-black-box-04/">

  


  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  




  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/drm-is-not-a-black-box-04/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@sandersaares">
  <meta property="twitter:creator" content="@sandersaares">
  
  <meta property="og:site_name" content="Sander Saares">
  <meta property="og:url" content="/post/drm-is-not-a-black-box-04/">
  <meta property="og:title" content="DRM is not a black box, part 4: key management | Sander Saares">
  <meta property="og:description" content="Historical key managament approaches leave it all in the care of the DRM vendor, leading to major lock-in and maintenance headaches that can require solution re-architecting when DRM vendors are changed or added. A modern solution architecture separates key management from DRM and enables flexible integration of solution components from different vendors."><meta property="og:image" content="/post/drm-is-not-a-black-box-04/featured.png">
  <meta property="twitter:image" content="/post/drm-is-not-a-black-box-04/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2020-05-22T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2020-05-22T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/drm-is-not-a-black-box-04/"
  },
  "headline": "DRM is not a black box, part 4: key management",
  
  "image": [
    "/post/drm-is-not-a-black-box-04/featured.png"
  ],
  
  "datePublished": "2020-05-22T00:00:00Z",
  "dateModified": "2020-05-22T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Sander Saares"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Sander Saares",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_2.png"
    }
  },
  "description": "\u003cp\u003eHistorical key managament approaches leave it all in the care of the DRM vendor, leading to major lock-in and maintenance headaches that can require solution re-architecting when DRM vendors are changed or added. A modern solution architecture separates key management from DRM and enables flexible integration of solution components from different vendors.\u003c/p\u003e"
}
</script>

  

  


  


  





  <title>DRM is not a black box, part 4: key management | Sander Saares</title>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  







<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/">Sander Saares</a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/">Sander Saares</a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Home</span></a>
        </li>

        
        

        

        
        
        

        
        
        
        
        
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#about"><span>About</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  <article class="article">

  




















  
  


<div class="article-container pt-3">
  <h1>DRM is not a black box, part 4: key management</h1>

  
  <p class="page-subtitle">DRM merely enforces policy and does not own keys</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/sandersaares/">Sander Saares</a></span>
  </div>
  
  

  
  <span class="article-date">
    
    
      
    
    May 22, 2020
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    15 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/media-streaming/">media streaming</a>, <a href="/categories/content-security/">content security</a>, <a href="/categories/drm-is-not-a-black-box/">DRM is not a black box</a></span>
  

</div>

  














</div>


<div class="article-header article-container featured-image-wrapper mt-4 mb-4" style="max-width: 608px; max-height: 440px;">
  <div style="position: relative">
    <img src="/post/drm-is-not-a-black-box-04/featured.png" alt="" class="featured-image">
    
  </div>
</div>



  <div class="article-container">

    <div class="article-style">
      <p>Historical key managament approaches leave it all in the care of the DRM vendor, leading to major lock-in and maintenance headaches that can require solution re-architecting when DRM vendors are changed or added. A modern solution architecture separates key management from DRM and enables flexible integration of solution components from different vendors.</p>
<p>The following important interactions take place in the key management domain:</p>
<ol>
<li>The content processing pipeline needs access to keys in order to encrypt media samples.</li>
<li>The DRM server needs access to keys in order to embed them into licenses that are delivered to DRM clients.</li>
<li>Authorization decisions must be informed by which keys are assocaited with which movies (and even which particular track).</li>
<li>Usage of keys is constrained by policy configuration.</li>
</ol>
<p>Key management practices and protocols are minimally standardized in the industry and large sections of the workflows remain implementation-specific. This article presents the key management architecture that the author believes provides the best capabilities in terms of flexible features and cross-vendor interoperability, though it is certainly not the only architecture in active use.</p>
<p>Keys are the technical mechanism that allows many parts of content usage policy to be associated with encrypted movie data. Therefore, a discussion of key management must by necessity also cover policy management. The two topics are presented here together.</p>
<h1 id="kid-is-in-the-focus">KID is in the focus</h1>
<p>Each key is identified by a unique KID (aka key ID). Keys are also logically associated with content, as each movie uses one or more keys (e.g. the SD video key, the HD video key and the audio key). Keys are not shared by different movies, though sometimes shared by several tracks of the same movie.</p>
<p>Different components involved in DRM workflows work either with the KIDs that identify individual keys or the content ID that identifies a movie, rarely both. When designing the solution architecture, it is important to understand where each type of identifier is appropriate. Needless mixing of different identifiers can lead to architectural creep and mixing of domain specific concepts that complicates future evolution of a solution.</p>
<p><strong>Keep any content ID or &ldquo;movie&rdquo; concept out of DRM interactions</strong>. DRM is about keys and the policy that applies to the keys, so focus the domain language on keys and policy, with data sets associated by the KIDs.</p>
<h1 id="flow-of-policy">Flow of policy</h1>
<p>To determine the policy to apply to a key, there must exist some link between the key and the relevant policy. The policy that governs use of a key is associated with a specific movie.</p>
<p>Content providers typically define policy based on classes of content, with the policy being different for each content provider. A simplified example might be:</p>
<ul>
<li>For library content (old content already released on DVD)
<ul>
<li>Same key may be used for all tracks.</li>
<li>Any production-grade DRM client robustness level is acceptable.</li>
</ul>
</li>
<li>For early window content (still in cinemas)
<ul>
<li>Separate key must be used for HD tracks.</li>
<li>Only high-robustness DRM clients are acceptable.</li>
</ul>
</li>
</ul>
<p>An operator configures all the necessary policies in the CMS database for each content provider.</p>





  
  











<figure id="figure-policies-are-defined-based-on-contracts-with-content-providers">



  <img data-src="/post/drm-is-not-a-black-box-04/define-policy-by-class_hu208c02fd1327f7c83f529a405c0da2d2_12310_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="711" height="100">



  
  
  <figcaption>
    Policies are defined based on contracts with content providers.
  </figcaption>


</figure>

<p>When a movie is submitted for ingest, it must be linked to the appropriate policy configuration. Based on the associated policy, the CMS needs to determine the key structure to use. The key and track associations are saved to the CMS database so that they can later be referenced to resolve the policy that applies to a specific key.</p>





  
  











<figure id="figure-the-links-between-keys-and-content-are-created-at-ingest-time">



  <img data-src="/post/drm-is-not-a-black-box-04/keys-vs-content-at-packagetime_hu7c3c9c499ffd4133cc4c8d9da985757a_33051_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="609" height="451">



  
  
  <figcaption>
    The links between keys and content are created at ingest time.
  </figcaption>


</figure>

<p>The policy to apply to a movie may change over time. Typically this is in the form of more relaxed constraints (e.g. when the content is no longer considered early window). Migrating content to use less strict policy is a simple database update that does not require re-processing of the content. Policy updates are published together with content catalog updates and take effect for any new playback authorizations granted by the authorization service.</p>
<p>The key-specific policy is assembled when publishing policy from the CMS database, combining the information on what keys are used by a movie with the content provider&rsquo;s policy that applies to that movie, specialized for each key and enhanced by solution-specific business logic (e.g. rules like &ldquo;must have &lsquo;HD&rsquo; subscription to authorize use of HD key&rdquo;).</p>





  
  











<figure id="figure-when-catalog-updates-are-published-policy-updates-are-likewise-published-for-any-affected-keys">



  <img data-src="/post/drm-is-not-a-black-box-04/keys-vs-content-at-publishtime_hu1ef9c5a2c77d3b67de59f433651e5299_29078_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="574" height="419">



  
  
  <figcaption>
    When catalog updates are published, policy updates are likewise published for any affected keys.
  </figcaption>


</figure>

<p>One effect of this workflow is that only the CMS needs to know which movie uses which keys - any DRM specific data sets published by the CMS directly reference individual keys and the policy associated with those keys.</p>
<p>When playback authorization is requested by an app, the authorization service inspects the policy of the requested keys and makes an individual decision for each key. The policy also supplies constraints that must be enforced by the DRM client. The configuration for these constraints is embedded into the authorization token, from which the DRM server transfers it to the generated license.</p>





  
  











<figure id="figure-drm-interactions-at-time-of-playback-operate-on-keys-which-are-linked-to-published-policy-data">



  <img data-src="/post/drm-is-not-a-black-box-04/keys-vs-content-at-playtime_hu8280e132107ab085e14ac72ca86834ee_41758_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="709" height="589">



  
  
  <figcaption>
    DRM interactions at time of playback operate on keys which are linked to published policy data.
  </figcaption>


</figure>

<p>The authorization token contains not only the proof of authorization but also the policy configuration that applies to each specific key. <strong>The main role of the DRM server is to translate part of the key usage policy into the constraints language of a specific DRM technology</strong>. Until the workflow reaches the DRM server, the policy enforcement logic is not tied to a specific DRM technology.</p>
<h1 id="creating-and-supplying-keys">Creating and supplying keys</h1>
<p>The <strong>key server</strong> is a database of keys and a set of APIs that can be used to access the keys. When keys are required by a component in the DRM workflows, they either request them from the key server or consume a key package previously exported from the key server.</p>
<p>CPIX<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> is the modern data format for key exchange. It defines a key package format that enables authenticated and confidential key delivery across the DRM ecosystem.</p>
<div class="alert alert-warning">
  <div>
    While CPIX defines a standard data format for the key package, the protocols and APIs that use CPIX remain proprietary at present, without a generally accepted standard. Often, entirely different key import/export APIs are used for integration with different 3rd party systems. In solution architectures with legacy components, many of these will not even be based on CPIX.
  </div>
</div>





  
  











<figure id="figure-cpix-documents-are-used-to-transfer-keys-between-components">



  <img data-src="/post/drm-is-not-a-black-box-04/key-movements-with-cpix_hu355db016463e9f911255c020b9f3770b_17735_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="486" height="280">



  
  
  <figcaption>
    CPIX documents are used to transfer keys between components.
  </figcaption>


</figure>

<p>The key server creates and stores new keys on demand. Once created, they may be exported for use by other services. This is typically done by the CMS, which passes the exported key packages on to other components during DRM workflow execution.</p>
<div class="alert alert-note">
  <div>
    Some content packagers use a pull model where they directly access the key server to request keys. While potentially simpler to implement, this offers less architectural flexibility and removes a security boundary that may be important for defense in depth.
  </div>
</div>
<p><strong>It is important to keep the funcionality of the key server simple and constrained, as it is a highly security-sensitive component that has full access to the keys</strong>. All duties that do not require access to keys should be moved out of the key server and into the CMS (which does not have access to keys).</p>
<p>The key server knows nothing about movies or whether a key is to be used for audio or video. Only very basic relations exist in the key server, largely for the purpose of supporting certain live streaming scenarios.</p>
<h1 id="securing-keys-in-transit">Securing keys in transit</h1>
<p>Keys exported from the key server are asymmetrically encrypted to ensure that only the intended final recipient (i.e. the content packager or DRM server) can unlock the key package.</p>
<p>It is common for the CMS requesting the key package to be unable to access the keys within because it is only an intermediary that coordinates the workflows and applies policy decisions. That is, the rights &ldquo;can create and export keys&rdquo; and &ldquo;can decrypt keys&rdquo; do not necessarily overlap among solution components.</p>
<div class="alert alert-warning">
  <div>
    The CPIX security mechanisms depend on implementation capabilities of the components using CPIX. Not every key server or packager in common use is capable of using encryption to secure keys transferred in CPIX documents. Verify the security capabilities of any products you plan to integrate into a solution.
  </div>
</div>
<p>A public key infrastructure must be in place for the access control mechanisms built into the CPIX document format to be usable.</p>
<h1 id="encrypting-media-samples">Encrypting media samples</h1>
<p>The key server can export a set of keys but that is not enough to encrypt media samples. There must also be a mapping of which keys to use for what type of content. The typical rule is &ldquo;use a different key for SD video, HD video, UHD video and audio&rdquo; but content provider policies can add additional complexity to this logic. This mapping can be described by the CPIX document format using simple rules such as:</p>
<ul>
<li>This key is to be used for video tracks.</li>
<li>This key is to be used for above 480p and up to 1080p resolution (HD).</li>
<li>This key is to be used for 5.1 channel audio tracks.</li>
</ul>
<p>Knowledge of what key is mapped to what tracks does not belong in the key server, however. This is the domain of the business logic, policy enforcement and workflow orchestration mechanisms in a solution typically embodied in the CMS. It knows which content provider a movie is from and knows the policies of that content provider. The CMS often also coordinates the activities of different solution components, giving them jobs and configuration. Therefore, it is the duty of the CMS to take a CPIX document exported from the key server and extend it with policy-based data.</p>





  
  











<figure id="figure-the-cms-extends-the-cpix-document-with-key-usage-rules-when-creating-content-processing-jobs">



  <img data-src="/post/drm-is-not-a-black-box-04/policy-in-cpix_hu2e999042c7abcae1b382521c90b83e58_21126_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="432" height="357">



  
  
  <figcaption>
    The CMS extends the CPIX document with key usage rules when creating content processing jobs.
  </figcaption>


</figure>

<p>For more details on how the acquired keys are used to encrypt content, refer back to 
<a href="../drm-is-not-a-black-box-02/">the article on content processing</a>.</p>
<p>Encryption interactions can be further complicated in live streaming scenarios where the keys and DRM metadata can change over time. This is explored in detail in the next article.</p>
<h1 id="providing-keys-to-drm-clients">Providing keys to DRM clients</h1>
<p>As described in 
<a href="../drm-is-not-a-black-box-03">the article on secure playback</a>, DRM clients request keys from DRM servers. Before that can happen, the key management workflows in a solution must deliver the keys to the one or more DRM servers.</p>
<p>A large solution may involve using multiple DRM servers from different vendors in parallel, for various legacy/contractual/policy/availability reasons. There is no universal architecture that can be assumed, beyond the need to be flexible.</p>
<p>DRM servers from some vendors require all keys to be inserted into a DRM server specific key database before the DRM server will use the keys in licenses. Indeed, there may be a separate DRM server database for each DRM server used in a solution.</p>





  
  











<figure id="figure-some-drm-servers-require-all-keys-to-be-individually-imported-before-use">



  <img data-src="/post/drm-is-not-a-black-box-04/import-to-keyservers_hua3ba3911ce2ba860067eb561246249ec_12138_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="488" height="181">



  
  
  <figcaption>
    Some DRM servers require all keys to be individually imported before use.
  </figcaption>


</figure>

<p>The mechanisms for providing keys to DRM servers are not standardized, although the CPIX protocol is designed to facilitate this exchange. Still, it is only a data format and does not define an API, so a proprietary mechanism must be used with each involved DRM server to invoke the import.</p>
<div class="alert alert-note">
  <div>
    Many previous-generation DRM servers assume that they are in control of key management and generation. This is not compatible with modern practices but remains a common cause of architectural complexity and integration headaches.
  </div>
</div>
<p>Not every DRM server requires the keys to be imported in advance (or at all). A more flexible architecture is to provide the keys to the DRM server as part of the license request sent by a player. This architecture uses the player as an intermediary to carry (encrypted) keys to a license server. Typically, the keys are requested on-demand and cached by the authorization service that resolves business logic and policy constraints when a player requests playback authorization.</p>
<div class="alert alert-note">
  <div>
    Caching the keys by the authorization service reduces needless interactions with the key server and improves service availability by allowing authorization tokens to be granted even during key server downtime (if required keys are cached).
  </div>
</div>
<p>Note that the authorization service only ever sees keys in encrypted form. Only the DRM server holds the private key required to decrypt the movie keys.</p>





  
  











<figure id="figure-some-drm-servers-can-accept-keys-embedded-into-authorization-tokens">



  <img data-src="/post/drm-is-not-a-black-box-04/attach-key-to-token_hude8a59985974405ef5e7e09f702f07b0_27229_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="714" height="450">



  
  
  <figcaption>
    Some DRM servers can accept keys embedded into authorization tokens.
  </figcaption>


</figure>

<p>By providing the keys together with the license request, the role of the DRM server is largely reduced to translating the policy attached to business logic authorization decisions into a DRM technology specific policy language. This enables the DRM server to be largely stateless, greatly reducing its complexity. As DRM servers often must be developed using idiosyncratic DRM technology SDKs, any simplification in the structure of and reduction in the role of DRM servers greatly improves solution maintainability. <strong>Prefer stateless workflows that use token-embedded keys instead of importing keys into a DRM server</strong>.</p>
<p>Standardized key export protocols like CPIX are imperfectly suitable for the embedded key architecture because CPIX documents are relatively large. This is a problem because authorization tokens are typically embedded into (size-limited) HTTP request headers. For this reason, a custom size-optimized data format is typically used for stateless DRM server workflows that use embedded keys.</p>
<h1 id="changing-keys-in-live-streams">Changing keys in live streams</h1>
<p>It is typical to change the keys in live streams on a regular interval. The purpose of this is to force re-authorization of the viewer<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>: a new key requires a new authorization token and license, which enables the solution components to ensure that the viewer still has a valid subscription for the content. A typical interval is 24 hours between key changes.</p>
<p>An alternative approach is to simply make the licenses (and authorization tokens) expire on an equivalent interval. While this can provide a roughly similar experience, there are many legacy DRM clients still deployed that do not possess a tamper-resistant clock and therefore cannot securely enforce time-based constraints. Changing the keys ensures that even such clients are forced to re-authenticate.</p>
<div class="alert alert-note">
  <div>
    It is a common misconception that the live stream keys are changed to improve cryptographic security. This is false. <strong>Changing the encryption keys on a regular basis provides no benefit in terms of cryptographic security.</strong>
  </div>
</div>
<p>Because the key will change at the same time for all viewers of a live stream it is important to deliver licenses containing the keys in advance of the actual key change and spread the license requests out across time to avoid overloading the DRM servers. Unfortunately, there are no industry-standard mechanisms for announcing upcoming keys, which means that the mechanism for preloading keys for upcoming key periods must be implemented using custom logic in each app.</p>
<p>Given that new keys must anyway be pushed to DRM clients ahead of time, which requires a timing/coordinating workflow in the CMS, the same workflow should be harnessed to also provide updated keys to the content packager.</p>





  
  











<figure id="figure-a-schedule-based-workflow-publishes-key-changes-to-both-drm-clients-by-publishing-content-catalog-updates-and-the-content-packager">



  <img data-src="/post/drm-is-not-a-black-box-04/key-changes_huf0f1a79386abda446788dd6806a7d763_31658_2000x2000_fit_lanczos_2.png" class="lazyload" alt="" width="715" height="454">



  
  
  <figcaption>
    A schedule-based workflow publishes key changes to both DRM clients (by publishing content catalog updates) and the content packager.
  </figcaption>


</figure>

<p>The mechanism for providing new keys in live stream scenarios is not standardized and is different for each content packager and key server implementation. Many different integration possibilities exist, depending on the exact set of products used in the solution. Some implementations may even use a &ldquo;pull&rdquo; model, where the content packager contacts an external service when it wants new keys.</p>
<h1 id="key-removal">Key removal</h1>
<p>Content is often licensed from content providers for a certain time span. For example, you may obtain rights to show certain movies for a 6-month period, after which you need to remove the content from your solution.</p>
<p>You can offer content providers a high level of confidence that this is done by ensuring that your key management workflows include key expiration and automatic expired key removal and unpublishing (with relevant audit logs).</p>
<h1 id="key-seeds">Key seeds</h1>
<p>Occasionally one encounters key management architectures where keys are not individually managed but instead are mathematically derived from a key seed based on the key ID, using the (conceptual) equation <code>key = key seed + key ID</code>.</p>
<p>In terms of cryptographic security there is nothing wrong with this - key seeds are a perfectly fine way to create keys. However, on a key management and solution architecture level this has various drawbacks:</p>
<ol>
<li>Even if you use key seeds to generate keys, you still need to track the usage policy associated with each key, largely defeating the simplicity in all but the simplest solutions that apply the same policy to all keys.</li>
<li>Integration is complicated between systems using key seeds and those that do not, potentially requiring intermediate databases to be developed/maintained/secured.</li>
<li>Different systems may use different key seed algorithms.</li>
<li>Key removal becomes difficult to enforce - by knowing the key seed and key ID you can recreate any key that was derived from the key seed. To securely remove keys from a solution, you need to remove the key seed itself as well as the keys.</li>
<li>Instead of tracking just a key ID in various places, you now find yourself tracking a key ID and a key seed ID, increasting complexity and creating additional opportunities for accidental data mismatch that can be very hard to discover.</li>
<li>The security model implications are different; assumptions made when securing invididual keys might not hold when securing key seeds.</li>
</ol>
<p>The above are only the most obvious complications - the more systems a solution integrates, the greater the compatibility and maintenance cost of a single factor and the greater the possible amount of surprises that can come up.</p>
<p>The primary advantage of a key seed approach is that you do not need to deliver new keys to the DRM server - as long as it knows the key seed, it can generate any key on its own. This may be an important feature in some rare scenarios.</p>
<p><strong>Avoid using key seeds</strong>. If you are forced to use key seeds (e.g. due to legacy reasons), limit their use to the key server and have every other component deal with individual keys. Using key seeds offers some tradeoffs in rare situations but often end up making the key life cycle in a solution more difficult to understand. As DRM is already a fairly challenging topic, it is valuable to keep things as straightforward as possible.</p>
<h1 id="key-security">Key security</h1>
<p>Keys must be secured against misused at all times. On the viewer&rsquo;s device, the DRM client cares for this. In all other components, the solution architecture must include required security measures to prevent key disclosure. When working with high-value content you must also protect against insider threats by the solution&rsquo;s own operators - just because someone has administrator access to the servers does not mean they should have access to keys!</p>
<p>Security is a huge topic that depends greatly on solution specific details. 
<a href="../../#contact">Consult an expert</a> to develop a scenario-appropriate key security model for you.</p>
<h1 id="coming-up-next">Coming up next</h1>
<p>DRM signaling is data embedded into movie manifest files. It informs players on how to activate DRM clients. In the next article we take a look at how it travels through the content workflows of a solution and how it should be handled.</p>
<p>
<a href="../../categories/drm-is-not-a-black-box/">View all articles in the series.</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>
<a href="https://dashif-documents.azurewebsites.net/CPIX/master/Cpix.html" target="_blank" rel="noopener">Content Protection Information Exchange Format (CPIX)</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>
<a href="https://dashif-documents.azurewebsites.net/Guidelines-Security/master/Guidelines-Security.html#CPS-PeriodReauth" target="_blank" rel="noopener">DASH-IF guidelines on periodic re-authorization</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
    </div>

    





<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/drm-is-not-a-black-box-04/&amp;text=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/drm-is-not-a-black-box-04/&amp;t=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management&amp;body=/post/drm-is-not-a-black-box-04/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/drm-is-not-a-black-box-04/&amp;title=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management%20/post/drm-is-not-a-black-box-04/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/drm-is-not-a-black-box-04/&amp;title=DRM%20is%20not%20a%20black%20box,%20part%204:%20key%20management" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/sandersaares/avatar_hub71303099b38f2f6cba13ac65c7c942f_84843_270x270_fill_q90_lanczos_center.jpg" alt="Sander Saares">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Sander Saares</a></h5>
      
      <p class="card-text">An expert in media streaming and content security</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:sander@saares.eu" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/sandersaares" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://stackoverflow.com/users/2928/sander" target="_blank" rel="noopener">
        <i class="fab fa-stack-overflow"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  





<section id="comments">
  
    <div id="commento"></div>

<script src="https://cdn.commento.io/js/commento.js" defer></script>

  
</section>






  
  



  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.8/mermaid.min.js" integrity="sha256-lyWCDMnMeZiXRi7Zl54sZGKYmgQs4izcT7+tKc+KUBk=" crossorigin="anonymous" title="mermaid"></script>
      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    © Sander Saares 2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
